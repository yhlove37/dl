<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.dao.AdminProductMapper">
    <select id="findAllProduct" parameterType="Product"
        resultType="ssm.entity.Product">
        select * from product
    </select>

    <select id="findAllCategory" parameterType="Category"
            resultType="ssm.entity.Category">
        select * from category
    </select>
    <select id="addProduct" parameterType="Product"
            resultType="ssm.entity.Product">
        insert into product values(#{pid},#{pname},#{market_price},
        #{shop_price},#{pimage},#{pdate},#{is_hot},#{pdesc},#{pflag},#{cid})
    </select>
    <select id="delProductById" parameterType="Product">
        delete from product where pid=#{pid}
    </select>
    <select id="findProductById" parameterType="Integer"
        resultType="ssm.entity.Product">
        select * from product where pid=#{pid}
    </select>
    <!-- 此处能不能用动态sql ??????-->
    <select id="updateProduct" parameterType="Product">
        update product set 
            pname = #{pname},
            market_price = #{market_price},
            shop_price = #{shop_price},
            pimage = #{pimage},
            pdate = #{pdate},
            is_hot = #{is_hot},
            pdesc = #{pdesc},
            pflag = #{pflag},
            cid = #{cid} 
        where pid = #{pid}
    </select>
    
    <!-- 这里用到的是mybatis的动态sql-->
    <!-- mybatis 官方文档关于动态sql: http://www.mybatis.org/mybatis-3/zh/dynamic-sql.html-->
    <select id="findProductListByConditionVo" parameterType="ssm.vo.ConditionVo"
            resultType="ssm.entity.Product">
        select * from product
        <where>
            <if test="pname != null and pname != ''" >
            <bind name="pnameLike" value="'%' + pname + '%'" />
                pname like #{pnameLike}
            </if>
            <if test="isHot != null and isHot != ''">
                and is_hot = #{isHot}
            </if>
            <if test="cid != null and cid != ''">
                and cid = #{cid}
            </if>
        </where>
    </select>



<!--    这里的map映射很重要-->
    <resultMap id="allOrderItemByOid" type="OrderItem">
        <result property="count" column="count"/>
        <result property="subtotal" column="subtotal"/>
        <association property="product" column="product" javaType="Product">
            <result property="pimage" column="pimage"/>
            <result property="pname" column="pname"/>
            <result property="shop_price" column="shop_price"/>
        </association>


    </resultMap>
    <select id="finOrderInfoByOid" parameterType="String"
            resultMap="allOrderItemByOid">
        select p.shop_price, p.pname, p.pimage, i.count, i.subtotal
        from orderitem i, product p
        where i.pid = p.pid and oid = #{oid}
    </select>



<!--一对多查询-->
    <resultMap id="orderUser" type="ssm.entity.Order">
        <result property="oid" column="oid"></result>
        <result property="orderTime" column="ordertime"></result>
        <result property="total" column="total"></result>
        <result property="state" column="state"></result>
        <result property="address" column="address"></result>
        <result property="name" column="name"></result>
        <result property="telephone" column="telephone"></result>
        <association property="user" column="uid" javaType="User" select="getUserByUid"></association>
    </resultMap>
    <!--查询全部订单信息-->
    <select id="findAllOrders" resultMap="orderUser">
        select * from orders
    </select>

    <select id="getUserByUid" resultType="ssm.entity.User">
        select * from User  where uid=#{uid}
    </select>



    <update id="deleterow" parameterType="String" >
        update category set
                          cstate=0
        where cid = #{cid}

    </update>



    <update id="updaterow" parameterType="Category">
        update category set
                            cname = #{cname},
                            cinfo = #{cinfo}
        where cid = #{cid}
    </update>
</mapper>
